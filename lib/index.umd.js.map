{"version":3,"file":"index.umd.js","sources":["../src/utils.ts","../src/index.ts"],"sourcesContent":["\r\nexport const isObject = (item: any) => {\r\n  return (item && typeof item === 'object' && !Array.isArray(item))\r\n}\r\n\r\nexport const isArray = (item: any) => {\r\n  return (item && typeof item === 'object' && Array.isArray(item))\r\n}\r\n\r\nexport const mergeObjects: any = (target: any, ...sources: any) => {\r\n    if (!sources.length) return target;\r\n    const source = sources.shift();\r\n  \r\n    if (isObject(target) && isObject(source)) {\r\n      for (const key in source) {\r\n        if (isObject(source[key])) {\r\n          if (!target[key]) target[key] = {}\r\n          mergeObjects(target[key], source[key])\r\n        } \r\n        else if (isArray(source[key]) && isArray(target[key])) {\r\n          target[key] = target[key].concat(source[key]) \r\n        }\r\n        else {\r\n          Object.assign(target, { [key]: source[key] })\r\n        }\r\n      }\r\n    }\r\n  \r\n    return mergeObjects(target, ...sources);\r\n  }","import * as yup from 'yup';\r\nimport { AnySchema, SchemaDescription } from \"yup/lib/schema\";\r\nimport { isArray, mergeObjects } from \"./utils\";\r\n\r\nconst __yuptoswagger__: any = { debug: false }\r\n\r\nconst { warn: warn_ } = console;\r\nconsole.warn = (...args) => __yuptoswagger__.debug ? warn_(...args) : undefined\r\n\r\ntype YTSCompilerOptions = {\r\n    debug: boolean;\r\n}\r\n\r\nclass YTSCompiler {\r\n    protected debug: boolean = false;\r\n    constructor(options?: YTSCompilerOptions) {\r\n        const keys: string[] = Object.keys(options || {});\r\n        for (let key of keys) {\r\n            switch (key) {\r\n                case \"debug\":\r\n                    __yuptoswagger__.debug = true;\r\n                    break;\r\n                default:\r\n                    console.warn(`${key} is not recognized as a valid option property`)\r\n            }\r\n        }\r\n    }\r\n\r\n    parse_tests(type: string, tests: any[]): any {\r\n        const map: any = {\r\n          \"string\": {\r\n              \"min\": \"minLength\",\r\n              \"max\": \"maxLength\",\r\n              \"email\": \"format\",\r\n              \"url\": \"format\",\r\n              \"uuid\": \"format\",\r\n              \"matches\": [ \"pattern\", \"regex\" ],\r\n              // required: todo\r\n          }\r\n        }\r\n\r\n        let properties: any = {};\r\n        const type_map = map[type];\r\n        for (let test of tests){\r\n              const { name, params } = test;\r\n            const match = type_map[name]\r\n            if (!match) {\r\n              console.warn(`[WARN] yuptoswagger.js: ignoring ${name}`)\r\n              continue\r\n            }\r\n            if (isArray(match) && match.length == 2) {\r\n              const [ key, value_key ] = match;\r\n              const value = params[value_key]\r\n              const value_str = value.toString ? value.toString() : value\r\n              properties[key] = value_str\r\n              continue\r\n            }\r\n            const value = params[name] || name\r\n            properties[match] = value;\r\n            console.log({ [match]: value })\r\n        }\r\n        return properties\r\n    }\r\n    parse_string_schema(type: string, properties: any) {\r\n        const { oneOf, tests } = properties;\r\n        \r\n        const enum_ = oneOf;\r\n\r\n        const schema: any = { type, enum: enum_ }\r\n        const from_test_properties = this.parse_tests(type, tests);\r\n      \r\n        console.log({ from_test_properties })\r\n        return mergeObjects({}, schema, from_test_properties);\r\n    }\r\n    parse_object_schema(type: string, properties: any) {\r\n      const schema = { type }\r\n      const fields = []\r\n      for (const field_key of Object.keys(properties.fields)) {\r\n        const field: SchemaDescription = properties.fields[field_key];\r\n        const parsed = this.compile(field)\r\n        fields.push(parsed);\r\n      }\r\n      return { ...schema, fields }\r\n    }\r\n    parse_spec_field(spec: any) {\r\n      const parsed: any = { }\r\n      \r\n      const { nullable } = spec;\r\n\r\n      if (nullable) parsed.nullable = nullable;\r\n      \r\n      return parsed;\r\n    }\r\n    isYupSchema<T extends AnySchema>(object: T): T | false {\r\n      return object.__isYupSchema__ ? object : false;\r\n    }\r\n    compile(schema: AnySchema | SchemaDescription): any;\r\n    compile(schema: AnySchema | SchemaDescription & { spec?: any }) {\r\n      let schema_description = schema;\r\n      \r\n      const yupSchema = this.isYupSchema(schema as AnySchema)\r\n      if (yupSchema) schema_description = yupSchema.describe();\r\n\r\n      console.log(schema_description,'schema_description');\r\n\r\n      const { type, ...properties } = schema_description;\r\n\r\n      let swagger_schema: any = {}\r\n      switch (type) {\r\n          case \"string\": swagger_schema = this.parse_string_schema(type, properties); break;\r\n          case \"object\": swagger_schema = this.parse_object_schema(type, properties); break;\r\n          default: return { failed: true };\r\n      }\r\n      const spec_properties = this.parse_spec_field(properties!.spec);\r\n      return { ...swagger_schema, ...spec_properties }\r\n    }\r\n}\r\n\r\nexport default YTSCompiler;"],"names":["isObject","item","Array","isArray","mergeObjects","target","sources","length","source","shift","key","concat","Object","assign","__yuptoswagger__","debug","warn","warn_","console","args","undefined","YTSCompiler","constructor","options","keys","parse_tests","type","tests","map","properties","type_map","test","name","params","match","value_key","value","value_str","toString","log","parse_string_schema","oneOf","enum_","schema","enum","from_test_properties","parse_object_schema","fields","field_key","field","parsed","compile","push","parse_spec_field","spec","nullable","isYupSchema","object","__isYupSchema__","schema_description","yupSchema","describe","swagger_schema","failed","spec_properties"],"mappings":"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"}